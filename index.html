<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Jeux Kabir — Bonneteau & Simon</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@500;700;900&display=swap" rel="stylesheet">
  <style>
    /* Styles optimisés */
    :root {
      --bg: #0f0f1f;
      --panel: #1e1e38;
      --muted: #cccccc;
      --accent: #ff4081;
      --accent-dark: #e91e63;
      --danger: #ff3b3b;
      --padRed: #ff5b87;
      --padGreen: #5bff88;
      --padBlue: #5bbfff;
      --padYellow: #ffe55b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      font-family: "Rubik", sans-serif;
      color: #fff;
    }
    .app { max-width: 960px; margin: auto; padding: 16px; }
    .screen { display: none; }
    .screen.active { display: block; }
    .btn {
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(180deg, var(--accent), var(--accent-dark));
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      margin: 6px;
    }
    .btn.ghost {
      background: transparent;
      border: 1px solid #fff;
      color: var(--muted);
    }
    .pad {
      width: 120px;
      height: 120px;
      border-radius: 16px;
      display: inline-block;
      margin: 10px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
    }
    .pad.red { background: var(--padRed); }
    .pad.green { background: var(--padGreen); }
    .pad.blue { background: var(--padBlue); }
    .pad.yellow { background: var(--padYellow); }
    .pad.active {
      transform: scale(1.1);
      box-shadow: 0 0 20px #fff;
    }
    #bnStage {
      position: relative;
      height: 200px;
      background: #222;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .cup {
      position: absolute;
      bottom: 20px;
      width: 80px;
      height: 80px;
      border-radius: 50% 50% 0 0;
      background: #555;
      cursor: pointer;
    }
    #ball {
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--danger);
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
    }
  </style>
</head>
<body>
  <div class="app">
    <h2>🎮 Jeux Kabir — Bonneteau & Simon</h2>
    <button id="toggleAmb" class="btn ghost">🎵 Musique ON/OFF</button>

    <!-- Écran Intro -->
    <div id="intro" class="screen active">
      <h3>🔐 Accès sécurisé</h3>
      <p id="qLabel">Question 1/2</p>
      <p id="qText">Qui est le meilleur ami de Kabir ?</p>
      <input id="qInput" placeholder="Ta réponse">
      <button id="qBtn" class="btn">Valider</button>
      <p id="qMsg"></p>
    </div>

    <!-- Menu -->
    <div id="menu" class="screen">
      <h3>📋 Menu Principal</h3>
      <button id="openBon" class="btn">🎩 Bonneteau</button>
      <button id="openSim" class="btn">🎵 Simon</button>
    </div>

    <!-- Bonneteau -->
    <div id="bon" class="screen">
      <h3>🎩 Bonneteau — Niveau <span id="bnLevel">1</span></h3>
      <div id="bnStage">
        <div id="cup0" class="cup" style="left:40px"></div>
        <div id="cup1" class="cup" style="left:160px"></div>
        <div id="cup2" class="cup" style="left:280px"></div>
        <div id="ball"></div>
      </div>
      <button id="mixBtn" class="btn">🔀 Mélanger</button>
      <button id="resetBn" class="btn ghost">🔄 Réinitialiser</button>
      <button id="backMenuBn" class="btn ghost">⬅ Retour</button>
      <p id="bnMsg">Regarde la balle, puis clique sur Mélanger.</p>
      <p>Score : <span id="bnScore">0</span></p>
    </div>

    <!-- Simon -->
    <div id="sim" class="screen">
      <h3>🎵 Simon — Niveau <span id="smLevel">0</span></h3>
      <div>
        <div class="pad red" data-idx="0"></div>
        <div class="pad green" data-idx="1"></div>
        <div class="pad blue" data-idx="2"></div>
        <div class="pad yellow" data-idx="3"></div>
      </div>
      <button id="startSim" class="btn">▶ Démarrer</button>
      <button id="resetSim" class="btn ghost">🔄 Réinitialiser</button>
      <button id="backMenuSim" class="btn ghost">⬅ Retour</button>
      <p>Score : <span id="smScore">0</span></p>
      <p id="smMsg">Prêt</p>
    </div>
  </div>

  <script>
    // ==== Audio ====
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const audio = new AudioCtx();
    const master = audio.createGain(); master.gain.value = 0.9; master.connect(audio.destination);
    const bgGain = audio.createGain(); bgGain.gain.value = 0.06; bgGain.connect(master);

    function ensureAudio() {
      if (audio.state === 'suspended') audio.resume();
    }

    function playNote(freq, dur = 0.3, type = 'sine') {
      const t = audio.currentTime;
      const o = audio.createOscillator(); o.type = type; o.frequency.setValueAtTime(freq, t);
      const g = audio.createGain(); g.gain.setValueAtTime(0.001, t);
      g.gain.exponentialRampToValueAtTime(1, t + 0.01);
      g.gain.exponentialRampToValueAtTime(0.001, t + dur);
      o.connect(g); g.connect(master); o.start(t); o.stop(t + dur + 0.02);
    }

    function clickSound() {
      const dur = 0.04;
      const buffer = audio.createBuffer(1, audio.sampleRate * dur, audio.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < data.length; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (data.length * 0.02));
      }
      const src = audio.createBufferSource(); src.buffer = buffer;
      const g = audio.createGain(); g.gain.value = 0.12;
      src.connect(g); g.connect(master); src.start();
    }

    let ambientOsc = null;
    function startAmbient() {
      if (ambientOsc) return;
      const o1 = audio.createOscillator(); o1.type = 'sine'; o1.frequency.value = 110;
      const g1 = audio.createGain(); g1.gain.value = 0.02; o1.connect(g1); g1.connect(bgGain);
      const o2 = audio.createOscillator(); o2.type = 'sine'; o2.frequency.value = 220;
      const g2 = audio.createGain(); g2.gain.value = 0.01; o2.connect(g2); g2.connect(bgGain);
      o1.start(); o2.start(); ambientOsc = [o1, o2];
    }
        function stopAmbient() {
      if (!ambientOsc) return;
      ambientOsc.forEach(o => o.stop());
      ambientOsc = null;
    }

    document.getElementById('toggleAmb').addEventListener('click', () => {
      ensureAudio();
      if (bgGain.gain.value > 0.01) {
        bgGain.gain.value = 0;
        stopAmbient();
      } else {
        bgGain.gain.value = 0.06;
        startAmbient();
      }
    });

    document.addEventListener('pointerdown', () => ensureAudio(), { once: true });

    // ==== Navigation ====
    const screens = {
      intro: document.getElementById('intro'),
      menu: document.getElementById('menu'),
      bon: document.getElementById('bon'),
      sim: document.getElementById('sim')
    };
    function show(id) {
      Object.values(screens).forEach(s => s.classList.remove('active'));
      screens[id].classList.add('active');
    }

    // ==== Questions ====
    const qA = { text: "Qui est le meilleur ami de Kabir ?", answer: "jesus" };
    const qB = { text: "Quelle est la première amoureuse de Kabir ?", answer: "francoise" };
    let qStep = 0;
    const qLabel = document.getElementById('qLabel'),
          qText = document.getElementById('qText'),
          qInput = document.getElementById('qInput'),
          qBtn = document.getElementById('qBtn'),
          qMsg = document.getElementById('qMsg');

    function setQuestion() {
      qLabel.textContent = `Question ${qStep + 1}/2`;
      qText.textContent = qStep === 0 ? qA.text : qB.text;
      qInput.value = '';
      qMsg.textContent = '';
    }

    qBtn.addEventListener('click', () => {
      const val = qInput.value.trim().toLowerCase();
      if ((qStep === 0 && val === qA.answer) || (qStep === 1 && val === qB.answer)) {
        show('menu');
        return;
      }
      if (qStep === 0) {
        qStep = 1;
        setQuestion();
      } else {
        qMsg.textContent = '❌ Mauvaise réponse';
      }
    });

    setQuestion();

    // ==== Bonneteau ====
    const cups = [document.getElementById('cup0'), document.getElementById('cup1'), document.getElementById('cup2')];
    const ball = document.getElementById('ball');
    const mixBtn = document.getElementById('mixBtn');
    const resetBn = document.getElementById('resetBn');
    const backMenuBn = document.getElementById('backMenuBn');
    const bnScoreEl = document.getElementById('bnScore');
    const bnLevelEl = document.getElementById('bnLevel');
    const bnMsg = document.getElementById('bnMsg');

    let bnPos = 0, bnScore = 0, bnLevel = 1, bnMixing = false;
    let cupOffsets = [0, 0, 0];

    function placeBall(idx) {
      bnPos = idx;
      const cup = cups[idx];
      const rect = cup.getBoundingClientRect();
      ball.style.left = rect.left + rect.width / 2 - 14 + 'px';
    }

    function swapCups(a, b) {
      return new Promise(res => {
        const dx = 100;
        let progress = 0;
        const step = () => {
          progress += 0.1;
          cupOffsets[a] += dx * 0.1;
          cupOffsets[b] -= dx * 0.1;
          cups.forEach((cup, i) => cup.style.transform = `translateX(${cupOffsets[i]}px)`);
          if (progress < 1) requestAnimationFrame(step);
          else {
            [cups[a], cups[b]] = [cups[b], cups[a]];
            [cupOffsets[a], cupOffsets[b]] = [cupOffsets[b], cupOffsets[a]];
            res();
          }
        };
        step();
      });
    }

    async function mixCups() {
      if (bnMixing) return;
      bnMixing = true;
      bnMsg.textContent = '🔀 Mélange en cours...';
      let moves = bnLevel + 2;
      for (let i = 0; i < moves; i++) {
        const a = Math.floor(Math.random() * 3);
        let b; do { b = Math.floor(Math.random() * 3); } while (b === a);
        await swapCups(a, b);
      }
      bnMixing = false;
      bnMsg.textContent = '🎯 Devine la balle !';
      placeBall(bnPos);
    }

    mixBtn.addEventListener('click', () => {
      clickSound();
      mixCups();
    });

    cups.forEach((cup, i) => {
      cup.dataset.index = i;
      cup.addEventListener('click', () => {
        if (bnMixing) return;
        if (parseInt(cup.dataset.index) === bnPos) {
          bnScore++; bnLevel++; bnMsg.textContent = '✅ Bien joué !'; playNote(440, 0.2);
        } else {
          bnScore = 0; bnLevel = 1; bnMsg.textContent = '❌ Perdu !'; playNote(220, 0.3, 'sawtooth');
        }
        bnScoreEl.textContent = bnScore;
        bnLevelEl.textContent = bnLevel;
        placeBall(Math.floor(Math.random() * 3));
      });
    });

    resetBn.addEventListener('click', () => {
      bnScore = 0; bnLevel = 1;
      bnScoreEl.textContent = 0;
      bnLevelEl.textContent = 1;
      bnMsg.textContent = 'Regarde la balle, puis clique sur Mélanger.';
      placeBall(Math.floor(Math.random() * 3));
    });

    backMenuBn.addEventListener('click', () => show('menu'));
    document.getElementById('openBon').addEventListener('click', () => show('bon'));

    // ==== Simon ====
    const pads = [...document.querySelectorAll('.pad')];
    const startSim = document.getElementById('startSim');
    const resetSim = document.getElementById('resetSim');
    const backMenuSim = document.getElementById('backMenuSim');
    const smLevelEl = document.getElementById('smLevel');
    const smScoreEl = document.getElementById('smScore');
    const smMsg = document.getElementById('smMsg');

    let simSeq = [], simUser = [], simLevel = 0, simScore = 0, simPlaying = false;

    function flashPad(idx) {
      pads[idx].classList.add('active');
      const freqs = [261, 329, 392, 523];
      playNote(freqs[idx], 0.3, 'sawtooth');
      setTimeout(() => pads[idx].classList.remove('active'), 300);
    }

    function nextRound() {
      simUser = [];
      simLevel++;
      smLevelEl.textContent = simLevel;
      smMsg.textContent = '👀 Regarde la séquence...';
      simSeq.push(Math.floor(Math.random() * pads.length));
      simPlaying = false;
      startSim.style.display = 'none';

      simSeq.forEach((v, i) => {
        setTimeout(() => flashPad(v), i * 600);
      });

      setTimeout(() => {
        smMsg.textContent = '👉 À toi !';
        simPlaying = true;
      }, simSeq.length * 600 + 400);
    }

    pads.forEach((pad, i) => {
      pad.addEventListener('click', () => {
        if (!simPlaying) return;
        flashPad(i);
        simUser.push(i);
        if (simUser[simUser.length - 1] !== simSeq[simUser.length - 1]) {
          smMsg.textContent = '❌ Perdu !';
          playNote(150, 0.3, 'sawtooth');
          simSeq = []; simUser = []; simLevel = 0; simScore = 0;
          smScoreEl.textContent = 0; smLevelEl.textContent = 0;
          simPlaying = false;
          startSim.style.display = 'inline-block';
        } else if (simUser.length === simSeq.length) {
          simScore += simLevel * 10;
          smScoreEl.textContent = simScore;
          playNote(880, 0.2);
          simPlaying = false;
          setTimeout(nextRound, 800);
        }
      });
    });

    startSim.addEventListener('click', () => {
      clickSound();
      simSeq = []; simUser = []; simLevel = 0; simScore = 0;
      smScoreEl.textContent = 0; smLevelEl.textContent = 0;
      nextRound();
    });
        resetSim.addEventListener('click', () => {
      simSeq = [];
      simUser = [];
      simLevel = 0;
      simScore = 0;
      smScoreEl.textContent = 0;
      smLevelEl.textContent = 0;
      smMsg.textContent = 'Prêt';
      startSim.style.display = 'inline-block';
    });

    backMenuSim.addEventListener('click', () => show('menu'));
    document.getElementById('openSim').addEventListener('click', () => show('sim'));
  </script>
</body>
</html>

    

   
