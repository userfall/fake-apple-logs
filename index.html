<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jeux Kabir & Samuel</title>
<style>
  body {
    margin: 0; font-family: 'Segoe UI', sans-serif; background: #111; color: #fff;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
  }
  h1,h2 { font-weight: bold; text-align: center; }
  button { font-size: 1.5rem; padding: 12px 24px; margin: 10px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }
  .active { display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .screen { display: none; width: 100%; height: 100vh; }
  #menu button { background: #ff6600; color: #fff; }
  #bon, #sim { flex-direction: column; gap: 15px; }
  #cups { display: flex; justify-content: center; gap: 30px; margin-top: 20px; }
  .cup { width: 100px; height: 120px; background: linear-gradient(to top, #c69c6d, #e0c097); border-radius: 0 0 20px 20px; display: flex; align-items: flex-end; justify-content: center; position: relative; font-weight: bold; font-size: 1.2rem; cursor: pointer; user-select: none; }
  #ball { width: 28px; height: 28px; background: yellow; border-radius: 50%; position: absolute; transition: all 0.2s; bottom: 120px; }
  .pad { width: 100px; height: 100px; margin: 10px; border-radius: 20px; background: #333; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; font-size: 2rem; }
  .pad.active { background: #ff0; }
  #pads { display: flex; flex-wrap: wrap; justify-content: center; }
  #confetti { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }
  input { font-size: 1.2rem; padding: 8px; border-radius: 8px; border: none; }
  #qMsg { color: red; font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<div id="intro" class="screen active">
  <h1>Made by Kabir & Samuel</h1>
  <p>RÃ©ponds au quiz pour continuer</p>
  <label id="qLabel"></label>
  <p id="qText"></p>
  <input id="qInput" type="text" placeholder="RÃ©ponse">
  <button id="qBtn">Valider</button>
  <div id="qMsg"></div>
</div>

<div id="menu" class="screen">
  <h1>Menu</h1>
  <button onclick="show('bon')">ðŸŽ© Bonneteau</button>
  <button onclick="show('sim')">ðŸŽ¶ Simon</button>
</div>

<div id="bon" class="screen">
  <h1>Bonneteau</h1>
  <div id="bnMsg">Regarde la balle, puis clique sur MÃ©langer.</div>
  <div id="cups">
    <div id="cup0" class="cup">0</div>
    <div id="cup1" class="cup">1</div>
    <div id="cup2" class="cup">2</div>
    <div id="ball"></div>
  </div>
  <button id="mixBtn">MÃ©langer</button>
  <button id="resetBn">Reset</button>
  <button id="backMenuBn">Menu</button>
  <p>Score: <span id="bnScore">0</span> | Niveau: <span id="bnLevel">1</span></p>
</div>

<div id="sim" class="screen">
  <h1>Simon</h1>
  <div id="smMsg">Appuie sur dÃ©marrer pour jouer</div>
  <div id="pads">
    <div class="pad">A</div>
    <div class="pad">B</div>
    <div class="pad">C</div>
    <div class="pad">D</div>
  </div>
  <button id="startSim">DÃ©marrer</button>
  <button id="resetSim">Reset</button>
  <button id="backMenuSim">Menu</button>
  <p>Score: <span id="smScore">0</span> | Niveau: <span id="smLevel">0</span></p>
</div>

<canvas id="confetti"></canvas>

<script>
// ==== Audio Setup ====
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audio = new AudioCtx();
const master = audio.createGain(); master.gain.value = 0.9; master.connect(audio.destination);
const bgGain = audio.createGain(); bgGain.gain.value = 0.06; bgGain.connect(master);

function ensureAudio() { if(audio.state==='suspended') audio.resume(); }
function playNote(freq,dur=0.36,type='sine',when=0){
  const t=audio.currentTime+when;
  const o=audio.createOscillator(); o.type=type; o.frequency.setValueAtTime(freq,t);
  const g=audio.createGain(); g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(1.0,t+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
  const f=audio.createBiquadFilter(); f.type='lowpass'; f.frequency.value=Math.max(800,freq*5);
  o.connect(f); f.connect(g); g.connect(master); o.start(t); o.stop(t+dur+0.02);
}
function clickSound(vol=0.12){
  const dur=0.04; const buffer=audio.createBuffer(1,audio.sampleRate*dur,audio.sampleRate);
  const data=buffer.getChannelData(0);
  for(let i=0;i<data.length;i++) data[i]=(Math.random()*2-1)*Math.exp(-i/(data.length*0.02));
  const src=audio.createBufferSource(); src.buffer=buffer;
  const g=audio.createGain(); g.gain.value=vol; src.connect(g); g.connect(master); src.start();
}
document.addEventListener('pointerdown',()=>ensureAudio(),{once:true});

// ==== Navigation ====
const screens={intro:document.getElementById('intro'),menu:document.getElementById('menu'),
bon:document.getElementById('bon'),sim:document.getElementById('sim')};
function show(id){ Object.values(screens).forEach(s=>s.classList.remove('active')); screens[id].classList.add('active'); }

// ==== Quiz ====
const qA={text:"Qui est le meilleur ami de Kabir ?", answer:"jesus"};
const qB={text:"Quelle est la premiÃ¨re amoureuse de Kabir ?", answer:"francoise"};
let qStep=0;
const qLabel=document.getElementById('qLabel'), qText=document.getElementById('qText'),
qInput=document.getElementById('qInput'), qBtn=document.getElementById('qBtn'), qMsg=document.getElementById('qMsg');
function setQuestion(){ qLabel.textContent=`Question ${qStep+1}/2`; qText.textContent=qStep===0?qA.text:qB.text; qInput.value=''; qMsg.textContent=''; }
qBtn.addEventListener('click',()=>{ const val=qInput.value.trim().toLowerCase();
if((qStep===0 && val===qA.answer)||(qStep===1 && val===qB.answer)){ show('menu'); return; }
if(qStep===0){ qStep=1; setQuestion(); } else { qMsg.textContent='DÃ©solÃ©, mauvaise rÃ©ponse'; }});
setQuestion();

// ==== Bonneteau ====
const cups=[document.getElementById('cup0'),document.getElementById('cup1'),document.getElementById('cup2')];
const ball=document.getElementById('ball');
const mixBtn=document.getElementById('mixBtn');
const resetBn=document.getElementById('resetBn');
const backMenuBn=document.getElementById('backMenuBn');
const bnScoreEl=document.getElementById('bnScore');
const bnLevelEl=document.getElementById('bnLevel');
const bnMsg=document.getElementById('bnMsg');
let bnPos=0,bnScore=0,bnLevel=1,bnMixing=false;
let cupPositions=[0,0,0];
function updateCupPositions(){ cups.forEach((cup,i)=>{ cup.style.transform=`translateX(${cupPositions[i]}px)`; }); }
function placeBall(idx){ bnPos=idx; const cup=cups[idx]; const rect=cup.getBoundingClientRect();
ball.style.left=rect.left+rect.width/2-14+'px'; ball.style.bottom='120px'; }
function swapCups(a,b){ return new Promise(res=>{ const delta=100; let progress=0; const step=()=>{
progress+=0.1; cupPositions[a]+=delta*0.1; cupPositions[b]-=delta*0.1; updateCupPositions();
if(progress<1) requestAnimationFrame(step); else{ [cups[a],cups[b]]=[cups[b],cups[a]]; [cupPositions[a],cupPositions[b]]=[cupPositions[b],cupPositions[a]];
updateCupPositions(); res(); } }; step(); }); }
async function mixCups(){ if(bnMixing) return; bnMixing=true; bnMsg.textContent='MÃ©lange en cours...';
let moves=bnLevel+2;
for(let i=0;i<moves;i++){ const a=Math.floor(Math.random()*3); let b; do{ b=Math.floor(Math.random()*3);}while(b===a); await swapCups(a,b); }
bnMixing=false; bnMsg.textContent='Devine la balle !'; placeBall(bnPos); }
mixBtn.addEventListener('click',()=>{ clickSound(); mixCups(); });
cups.forEach((cup,i)=>{ cup.dataset.index=i; cupPositions[i]=0; cup.addEventListener('click',()=>{
if(bnMixing) return;
if(parseInt(cup.dataset.index)===bnPos){ bnScore++; bnLevel++; bnMsg.textContent='âœ… Bien jouÃ© !'; playNote(440,0.2); confettiBurst(); }
else{ bnScore=0; bnLevel=1; bnMsg.textContent='âŒ Perdu !'; playNote(180,0.3,'sawtooth'); }
bnScoreEl.textContent=bnScore; bnLevelEl.textContent=bnLevel;
placeBall(Math.floor(Math.random()*3)); }); });
resetBn.addEventListener('click',()=>{ bnScore=0; bnLevel=1; bnScoreEl.textContent=0; bnLevelEl.textContent=1;
bnMsg.textContent='Regarde la balle, puis clique sur MÃ©langer.'; placeBall(Math.floor(Math.random()*3)); });
backMenuBn.addEventListener('click',()=>show('menu'));

// ==== Simon ====
const pads=[...document.querySelectorAll('.pad')];
const startSim=document.getElementById('startSim');
const resetSim=document.getElementById('resetSim');
const backMenuSim=document.getElementById('backMenuSim');
const smLevelEl=document.getElementById('smLevel');
const smScoreEl=document.getElementById('smScore');
const smMsgEl=document.getElementById('smMsg');
let simSeq=[], simUser=[], simLevel=0, simScore=0, simPlaying=false;

function flashPad(idx){ pads[idx].classList.add('active'); playNote(220+idx*110,0.3); setTimeout(()=>pads[idx].classList.remove('active'),300);}
function simMsg(msg){ smMsgEl.textContent=msg; }

function nextRound(){ simUser=[]; simLevel++; smLevelEl.textContent=simLevel; simMsg('Regarde la sÃ©quence...'); simSeq.push(Math.floor(Math.random()*pads.length));
simPlaying=false; startSim.style.display='none'; simSeq.forEach((v,i)=>setTimeout(()=>flashPad(v), i*600));
setTimeout(()=>{ simMsg('Ã€ toi !'); simPlaying=true; startSim.style.display='none'; }, simSeq.length*600+300); }

pads.forEach((pad,i)=>{ pad.addEventListener('click',()=>{ if(!simPlaying) return; flashPad(i); simUser.push(i);
if(simUser[simUser.length-1]!==simSeq[simUser.length-1]){ simMsg('âŒ Perdu !'); playNote(150,0.3,'sawtooth'); simSeq=[]; simUser=[]; simLevel=0; simScore=0; smScoreEl.textContent=0; smLevelEl.textContent=0; simPlaying=false; startSim.style.display='inline-flex'; }
else if(simUser.length===simSeq.length){ simScore+=simLevel*10; smScoreEl.textContent=simScore; playNote(440,0.2); confettiBurst(); simPlaying=false; setTimeout(nextRound,500); startSim.style.display='none'; } }); });

startSim.addEventListener('click',()=>{ clickSound(); simSeq=[]; simUser=[]; simLevel=0; simScore=0; smScoreEl.textContent=0; smLevelEl.textContent=0; nextRound(); startSim.style.display='none'; });
resetSim.addEventListener('click',()=>{ simSeq=[]; simUser=[]; simLevel=0; simScore=0; smScoreEl.textContent=0; smLevelEl.textContent=0; simMsg('PrÃªt !'); startSim.style.display='inline-flex'; });
backMenuSim.addEventListener('click',()=>show('menu'));

// ==== Confetti ====
const confCanvas=document.getElementById('confetti'); const ctx=confCanvas.getContext('2d');
let confettiParticles=[];
function resizeCanvas(){ confCanvas.width=window.innerWidth; confCanvas.height=window.innerHeight; }
window.addEventListener('resize',resizeCanvas); resizeCanvas();

function confettiBurst(){
  for(let i=0;i<50;i++){ confettiParticles.push({ x:Math.random()*confCanvas.width, y:Math.random()*confCanvas.height-100, r:Math.random()*6+2, dx:(Math.random()-0.5)*6, dy:Math.random()*6+2, color:`hsl(${Math.random()*360},100%,50%)` }); } 
}
function updateConfetti(){ ctx.clearRect(0,0,confCanvas.width,confCanvas.height);
confettiParticles.forEach(p=>{ p.x+=p.dx; p.y+=p.dy; p.dy+=0.1; ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });
confettiParticles=confettiParticles.filter(p=>p.y<confCanvas.height+20); requestAnimationFrame(updateConfetti); }
updateConfetti();
</script>
</body>
</html>
