<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KabirCam Pro Intrusion</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  html, body {
    margin:0; padding:0; height:100%;
    background: #070b07;
    color: #00ff55;
    font-family: 'Lucida Console', Monaco, monospace, monospace;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  button {
    cursor: pointer;
    background: linear-gradient(135deg, #004400, #007700);
    border: 2px solid #00ff55;
    color: #00ff55;
    font-weight: 700;
    font-size: 1.3rem;
    padding: 14px 28px;
    border-radius: 10px;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover {
    background: linear-gradient(135deg, #007700, #00aa00);
  }
  button:disabled {
    background: #003300;
    border-color: #005500;
    color: #006600;
    cursor: not-allowed;
  }

  /* Containers */
  #welcomeScreen, #cameraScreen, #terminalScreen {
    width: 100vw;
    max-width: 640px;
    height: 100vh;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select: none;
    box-sizing: border-box;
  }
  .hidden {
    display: none !important;
  }

  /* Welcome Screen */
  #welcomeScreen h1 {
    font-size: 3rem;
    letter-spacing: 2px;
    margin-bottom: 20px;
    text-shadow: 0 0 15px #00ff55aa;
  }
  #welcomeScreen p {
    font-size: 1.3rem;
    margin-bottom: 30px;
    color: #00cc44;
    text-shadow: 0 0 8px #00ff55bb;
  }

  /* Camera Screen */
  #cameraScreen h2 {
    font-size: 2rem;
    margin-bottom: 20px;
    text-shadow: 0 0 12px #00ff55cc;
  }
  #cameraVideo {
    width: 100%;
    max-width: 620px;
    border-radius: 16px;
    border: 5px solid #00ff55aa;
    box-shadow: 0 0 15px #00ff55cc;
    background-color: #000;
    user-select: none;
  }
  #startIntrusionBtn {
    margin-top: 30px;
    padding: 16px 36px;
    font-size: 1.3rem;
    font-weight: 800;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    box-shadow: 0 0 30px #ff0000aa;
    background: linear-gradient(45deg, #660000, #aa0000);
    border: 3px solid #ff3300;
    color: #ff4444;
    transition: background 0.25s ease;
  }
  #startIntrusionBtn:hover:not(:disabled) {
    background: linear-gradient(45deg, #aa0000, #ff3333);
    box-shadow: 0 0 50px #ff3300;
  }
  #startIntrusionBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* Red overlay flash for transition */
  #redFlash {
    position: fixed;
    inset: 0;
    background: rgba(255, 0, 0, 0);
    pointer-events: none;
    z-index: 9999;
    transition: background 0.5s ease;
  }
  #redFlash.active {
    background: rgba(255, 0, 0, 0.75);
    animation: pulseRed 1.5s ease-in-out infinite alternate;
  }
  @keyframes pulseRed {
    0% { background: rgba(255, 0, 0, 0.55); }
    100% { background: rgba(255, 0, 0, 0.85); }
  }

  /* Terminal Screen */
  #terminalScreen {
    background: #000000dd;
    border: 4px solid #00ff55;
    box-shadow: 0 0 20px #00ff55cc inset;
    border-radius: 18px;
    font-size: 1.15rem;
    letter-spacing: 1.4px;
    line-height: 1.3;
    padding: 20px;
    color: #00ff44;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    overflow-y: auto;
    user-select: text;
  }

  /* blinking cursor */
  .blinking-cursor {
    border-right: 2px solid #00ff55;
    animation: blink 1s steps(2, start) infinite;
    display: inline-block;
  }
  @keyframes blink {
    0%, 50% { border-color: #00ff55; }
    51%, 100% { border-color: transparent; }
  }

  /* Scrollbar for terminal */
  #terminalScreen::-webkit-scrollbar {
    width: 12px;
  }
  #terminalScreen::-webkit-scrollbar-thumb {
    background-color: #00ff44cc;
    border-radius: 6px;
    border: 3px solid transparent;
    background-clip: content-box;
  }
  #terminalScreen::-webkit-scrollbar-track {
    background: #001000;
  }

  /* Final alert style */
  #finalAlert {
    margin-top: 25px;
    font-size: 1.6rem;
    font-weight: 900;
    letter-spacing: 1.8px;
    color: #ff2200;
    text-shadow: 0 0 20px #ff2200bb;
    text-align: center;
    user-select: none;
  }

  /* Responsive */
  @media (max-width: 700px) {
    #welcomeScreen, #cameraScreen, #terminalScreen {
      max-width: 100vw;
      padding: 15px;
    }
    #welcomeScreen h1 {
      font-size: 2.4rem;
    }
    #cameraScreen h2 {
      font-size: 1.7rem;
    }
    #startIntrusionBtn {
      padding: 14px 24px;
      font-size: 1.1rem;
    }
    #terminalScreen {
      font-size: 1rem;
      letter-spacing: 1.2px;
    }
    #finalAlert {
      font-size: 1.3rem;
    }
  }
</style>
</head>
<body>

<!-- Step 1: Welcome -->
<div id="welcomeScreen">
  <h1>KABIR SYSTEM</h1>
  <p>Cliquez pour activer la caméra frontale</p>
  <button id="btnStartCamera">Activer caméra</button>
</div>

<!-- Step 2: Camera -->
<div id="cameraScreen" class="hidden">
  <h2>Caméra activée</h2>
  <video id="cameraVideo" autoplay muted playsinline></video>
  <button id="btnStartIntrusion">Lancer intrusion</button>
</div>

<!-- Step 2.5: Red Flash -->
<div id="redFlash"></div>

<!-- Step 3: Terminal -->
<div id="terminalScreen" class="hidden" aria-live="polite" aria-atomic="true" role="log"></div>

<script>
  // Elements
  const welcomeScreen = document.getElementById('welcomeScreen');
  const cameraScreen = document.getElementById('cameraScreen');
  const terminalScreen = document.getElementById('terminalScreen');
  const redFlash = document.getElementById('redFlash');
  const btnStartCamera = document.getElementById('btnStartCamera');
  const btnStartIntrusion = document.getElementById('btnStartIntrusion');
  const video = document.getElementById('cameraVideo');

  let stream = null;
  let audioCtx = null;

  // WebAudio beep helper
  function beep(frequency=800, duration=120, type='square', volume=0.07) {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
    gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration/1000);
    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration/1000);
  }

  // Typing effect with beep
  async function typeLine(text, delay=20, beepOnEnd=true, error=false) {
    return new Promise(resolve => {
      let i=0;
      const cursor = document.createElement('span');
      cursor.className = 'blinking-cursor';
      terminalScreen.appendChild(cursor);

      function typeChar(){
        if(i < text.length) {
          cursor.insertAdjacentText('beforebegin', text[i]);
          i++;
          setTimeout(typeChar, delay + Math.random()*10);
        } else {
          if(beepOnEnd) {
            if(error) beep(400, 150, 'square', 0.09);
            else beep(900, 90, 'square', 0.07);
          }
          terminalScreen.removeChild(cursor);
          terminalScreen.appendChild(document.createTextNode('\n'));
          terminalScreen.scrollTop = terminalScreen.scrollHeight;
          setTimeout(resolve, 200);
        }
      }
      typeChar();
    });
  }

  // Lines for intrusion simulation
  const intrusionLines = [
    "Connexion à l'hôte 192.168.1.12...",
    "Authentification SSH : échec - mot de passe incorrect",
    "Tentative de contournement...",
    "Accès refusé - tentative 1/3",
    "Accès refusé - tentative 2/3",
    "Accès refusé - tentative 3/3",
    "Erreur fatale : échec de l'authentification",
    "Activation du mode root (local)...",
    "Chargement du module d'injection...",
    "Injection réussie",
    "Établissement du tunnel sécurisé vers RIBACK...",
    "Transfert des données utilisateur en cours...",
    "[███████████████.............] 56%",
    "Erreur de transmission détectée - tentative de reconnection",
    "[████████████████████████....] 87%",
    "Transfert terminé avec succès",
    "Déconnexion du serveur"
  ];

  // Start camera
  btnStartCamera.addEventListener('click', async () => {
    try {
      stream = await navigator.mediaDevices.getUserMedia({video: {facingMode:'user'}});
      video.srcObject = stream;
      welcomeScreen.classList.add('hidden');
      cameraScreen.classList.remove('hidden');
      if(audioCtx && audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    } catch(e) {
      alert('Erreur accès caméra: ' + e.message);
    }
  });

  // Red flash animation before terminal
  function playRedFlash() {
    return new Promise(resolve => {
      redFlash.classList.add('active');
      beep(350, 700, 'sawtooth', 0.15);
      setTimeout(() => {
        redFlash.classList.remove('active');
        resolve();
      }, 1500);
    });
  }

  // Run intrusion terminal
  async function runIntrusion() {
    cameraScreen.classList.add('hidden');
    await playRedFlash();
    terminalScreen.textContent = '';
    terminalScreen.classList.remove('hidden');

    for(let line of intrusionLines){
      const isError = /échec|Erreur|Accès refusé/i.test(line);
      await typeLine('> ' + line, 18, true, isError);
    }
    // Final beep error sequence
    for(let i=0; i<3; i++) {
      beep(300, 200, 'square', 0.1);
      await new Promise(r => setTimeout(r, 270));
    }
    terminalScreen.appendChild(document.createTextNode("\n>> TOUS VOS DONNÉES ONT ÉTÉ TRANSMIS À RIBACK <<"));
    terminalScreen.scrollTop = terminalScreen.scrollHeight;
  }

  btnStartIntrusion.addEventListener('click', async () => {
    if(audioCtx && audioCtx.state === 'suspended') {
      await audioCtx.resume();
    }
    btnStartIntrusion.disabled = true;
    await runIntrusion();
  });

  window.addEventListener('beforeunload', () => {
    if(stream) {
      stream.getTracks().forEach(track => track.stop());
    }
    if(audioCtx) {
      audioCtx.close();
    }
  });
</script>

</body>
</html>
