<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Lane Runner Ultimate</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    header, footer {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      text-align: center;
      box-shadow: 0 0 10px #0ff;
    }
    header button {
      background: #0ff;
      border: none;
      padding: 8px 15px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      box-shadow: 0 0 10px #0ff;
      margin: 0 5px;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    canvas {
      background: linear-gradient(180deg,#111,#000);
      border: 2px solid #0ff;
      box-shadow: 0 0 20px #0ff;
    }
    #hud {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 18px;
    }
    #menu {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background: rgba(0,0,0,0.8);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 20px #0ff;
    }
    #menu h1 {
      margin-bottom: 20px;
      font-size: 2em;
      color: #0ff;
    }
    #menu button {
      padding: 10px 20px;
      font-size: 1em;
      background: #0ff;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 10px #0ff;
    }
  </style>
</head>
<body>
  <header>
    <button id="startBtn">▶ Jouer</button>
    <button id="pauseBtn">⏸ Pause</button>
  </header>
  <main>
    <canvas id="gameCanvas"></canvas>
    <div id="hud"></div>
    <div id="menu">
      <h1>Neon Lane Runner</h1>
      <button id="playBtn">Commencer</button>
    </div>
  </main>
  <footer>by Kabir & Samuel Deporno</footer>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth * 0.8;
    canvas.height = window.innerHeight * 0.7;

    let gameRunning = false, paused = false;
    let player, obstacles = [], coins = [], powerUps = [];
    let score = 0, lives = 3, speed = 5, frame = 0, time = 0;
    const laneCount = 3, laneWidth = canvas.width / laneCount;

    class Player {
      constructor() {
        this.lane = 1;
        this.y = canvas.height - 80;
        this.width = laneWidth * 0.6;
        this.height = 40;
        this.color = "cyan";
      }
      moveLeft() { if (this.lane > 0) this.lane--; }
      moveRight() { if (this.lane < laneCount - 1) this.lane++; }
      draw() {
        ctx.fillStyle = this.color;
        ctx.shadowBlur = 20;
        ctx.shadowColor = this.color;
        ctx.fillRect(this.lane * laneWidth + laneWidth * 0.2, this.y, this.width, this.height);
        ctx.shadowBlur = 0;
      }
    }

    class Obstacle {
      constructor(lane) {
        this.lane = lane;
        this.y = -50;
        this.width = laneWidth * 0.6;
        this.height = 40;
        this.color = "red";
      }
      update() { this.y += speed; }
      draw() {
        ctx.fillStyle = this.color;
        ctx.shadowBlur = 15;
        ctx.shadowColor = "red";
        ctx.fillRect(this.lane * laneWidth + laneWidth * 0.2, this.y, this.width, this.height);
        ctx.shadowBlur = 0;
      }
    }

    class Coin {
      constructor(lane) {
        this.lane = lane;
        this.y = -30;
        this.size = 20;
        this.color = "gold";
      }
      update() { this.y += speed; }
      draw() {
        ctx.beginPath();
        ctx.arc(this.lane * laneWidth + laneWidth / 2, this.y, this.size / 2, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.shadowBlur = 15;
        ctx.shadowColor = "gold";
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }

    class PowerUp {
      constructor(lane, type) {
        this.lane = lane;
        this.y = -30;
        this.size = 25;
        this.type = type;
      }
      update() { this.y += speed; }
      draw() {
        ctx.beginPath();
        ctx.arc(this.lane * laneWidth + laneWidth / 2, this.y, this.size / 2, 0, Math.PI * 2);
        ctx.fillStyle = (this.type === "slow") ? "blue" : (this.type === "magnet" ? "purple" : "green");
        ctx.shadowBlur = 20;
        ctx.shadowColor = ctx.fillStyle;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }

    function init() {
      player = new Player();
      obstacles = [];
      coins = [];
      powerUps = [];
      score = 0;
      lives = 3;
      speed = 5;
      frame = 0;
      time = 0;
      gameRunning = true;
      paused = false;
      document.getElementById("menu").style.display = "none";
      loop();
    }

    function loop() {
      if (!gameRunning || paused) return;
      frame++;
      time = Math.floor(frame / 60);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBackground();

      if (frame % 60 === 0) {
        if (Math.random() < 0.6) obstacles.push(new Obstacle(Math.floor(Math.random() * laneCount)));
        if (Math.random() < 0.4) coins.push(new Coin(Math.floor(Math.random() * laneCount)));
        if (Math.random() < 0.1) {
          const types = ["slow", "magnet", "double"];
          powerUps.push(new PowerUp(Math.floor(Math.random() * laneCount), types[Math.floor(Math.random() * types.length)]));
        }
      }

      player.draw();

      for (let i = obstacles.length - 1; i >= 0; i--) {
        obstacles[i].update();
        obstacles[i].draw();
        if (collides(player, obstacles[i])) {
          lives--;
          obstacles.splice(i, 1);
          if (lives <= 0) endGame();
        } else if (obstacles[i].y > canvas.height) obstacles.splice(i, 1);
      }

      for (let i = coins.length - 1; i >= 0; i--) {
        coins[i].update();
        coins[i].draw();
        if (collides(player, coins[i])) {
          score += 10;
          coins.splice(i, 1);
        } else if (coins[i].y > canvas.height) coins.splice(i, 1);
      }

      for (let i = powerUps.length - 1; i >= 0; i--) {
        powerUps[i].update();
        powerUps[i].draw();
        if (collides(player, powerUps[i])) {
          activatePowerUp(powerUps[i].type);
          powerUps.splice(i, 1);
        } else if (powerUps[i].y > canvas.height) powerUps.splice(i, 1);
      }

      // HUD
      document.getElementById("hud").innerHTML = `Score: ${score}<br>Vies: ${lives}<br>Temps: ${time}s`;

            // Difficulté progressive
      if (score % 100 === 0 && score !== 0) {
        speed = Math.min(10, speed + 0.5);
      }

      requestAnimationFrame(loop);
    }

    function drawBackground() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function collides(a, b) {
      return (
        a.lane === b.lane &&
        b.y + (b.height || b.size) > a.y &&
        b.y < a.y + a.height
      );
    }

    function activatePowerUp(type) {
      if (type === "slow") {
        speed = 2;
        setTimeout(() => speed = 5, 3000);
      } else if (type === "magnet") {
        for (let i = coins.length - 1; i >= 0; i--) score += 10;
        coins = [];
      } else if (type === "double") {
        let old = score;
        setTimeout(() => score += old, 3000);
      }
    }

    function endGame() {
      gameRunning = false;
      alert(`Game Over! Score: ${score}`);
      document.getElementById("menu").style.display = "block";
    }

    // Contrôles clavier
    document.addEventListener("keydown", (e) => {
      if (!gameRunning) return;
      if (e.key === "ArrowLeft") player.moveLeft();
      if (e.key === "ArrowRight") player.moveRight();
      if (e.key.toLowerCase() === "p") {
        paused = !paused;
        if (!paused) loop();
      }
    });

    // Contrôles tactiles
    let touchStartX = 0;
    document.addEventListener("touchstart", (e) => {
      touchStartX = e.touches[0].clientX;
    });
    document.addEventListener("touchend", (e) => {
      let dx = e.changedTouches[0].clientX - touchStartX;
      if (dx > 50) player.moveRight();
      else if (dx < -50) player.moveLeft();
    });

    // Boutons
    document.getElementById("startBtn").addEventListener("click", () => {
      init();
    });
    document.getElementById("playBtn").addEventListener("click", () => {
      init();
    });
    document.getElementById("pauseBtn").addEventListener("click", () => {
      paused = !paused;
      if (!paused) loop();
    });

    // Responsive canvas
    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth * 0.8;
      canvas.height = window.innerHeight * 0.7;
    });
  </script>
</body>
</html>
